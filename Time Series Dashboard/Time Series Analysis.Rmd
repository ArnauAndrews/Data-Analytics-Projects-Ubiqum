---
title: "Time Series Analysis"
output: html_document
date: "2023-06-14"
---

Big news about a new project!
Hi,

I have exciting news!

A large regional residential developer is designing a large 'Smart Home' apartment housing development and is looking for evidence or positive reasons for adopting the use of electrical sub-metering devices used for power management in Smart Homes.

Installing these sub-meters could be a big step towards the developer's goal of offering highly efficient Smart Homes that provide owners with power usage analytics - a large piece of their planned marketing efforts.

We have been asked to find enough evidence to help support the developer's marketing claims of sub-meters providing owners with 'useful' power usage analytics; we need to do this by performing an 'analytical deep dive' of sub-metering generated data and producing high quality visualizations that support a positive narrative or story around your findings (you will create this narrative).  

We have also been asked to demonstrate that we can predict future energy consumption from the same data; this would help further support their adoption of sub-meters from the viewpoint of possible energy consumption reduction and a monetary savings as a result.,

As a starting point, they have provided us with a very large data set that contains 47 months of energy usage data from these devices. Our job over the next few weeks will be to analyze this data to determine what kind of analytics and visualizations can be created that would empower Smart Home owners with greater understanding and control of their power usage.

Since you are new at IOT Analytics, I’ll explain our onboarding process for new clients.

- Conduct research to become informed on the client’s business. In this case, you will need to get up to speed on the domains of Smart Homes, sub-meters and household power consumption.

- Identify any analytic skill/knowledge gaps foreseen for the project and plug those gaps with self-learning. With a data set this big, data munging and sub-setting will be essential to the analytic process. Working with DateTime and Time Series also needs to be mastered.

- Perform an initial exploration of the data. This exploration should be used to understand any potential issues, conduct early preprocessing, note summary statistics and identify any early recommendations about improvements to future data collection.
 
- Hold a project kick-off meeting with the client to close the deal. This meeting will center around a presentation that contains all of the project details and our initial exploration of the data.

- Your initial task is to work through the onboarding process and produce a PowerPoint presentation that will be delivered to the home developer’s management team during the kick off meeting. This report will give them confidence in our process and convince them that this project is relevant to their business needs.

It is important to remember that we do not know what the data will show, and neither does the developer; it is your job to tell them how we will conduct the analysis and what they are likely to gain, so be precise and accurate with your findings and any initial recommendations. However, keep in mind that you will be presenting your report to business rather than technical people.

Good luck,

Kathy

VP, IOT Analytics



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(RMySQL)
library(dplyr)
library(lubridate)
library(tidyverse)
library(plotly)
library(ggplot2)
library(ggfortify)
library(fracdiff)
library(plotly)
library(tidyquant)
library(lubridate)
library(forecast)
library(zoo)
library(dplyr)
library(fpp2)
library(shiny)
library(textshaping)
library(inline)
library(pryr)
library(stats)

```


```{r}
## Create a database connection 
#con = dbConnect(MySQL(), user='deepAnalytics', password='Sqltask1234!', dbname='dataanalytics2018', #host='data-analytics-2018.cbrosir2cswx.us-east-1.rds.amazonaws.com')
```


```{r}
## Create a database connection 
#y2007 <- dbGetQuery(con, "SELECT * FROM yr_2007")
#y2008 <- dbGetQuery(con, "SELECT * FROM yr_2008")
#y2009 <- dbGetQuery(con, "SELECT * FROM yr_2009")
```

####  2nd Option: Download the Data:

```{r}

# Load required libraries
library(shiny)
library(DBI)
library(dplyr)

# Define UI for the Shiny app
ui <- fluidPage(
  # Application title
  titlePanel("Database Connection"),
  
  # Sidebar layout
  sidebarLayout(
    # Sidebar panel
    sidebarPanel(
      # Database connection inputs
      textInput("user_input", "Username", value = ""),
      passwordInput("password_input", "Password", value = ""),
      textInput("dbname_input", "Database Name", value = ""),
      textInput("host_input", "Host", value = ""),
      
      # Action button to trigger connection and data retrieval
      actionButton("connect_button", "Connect to Database")
    ),
    
    # Main panel
    mainPanel(
      # Output for status message
      verbatimTextOutput("status_output"),
      
      # Output for downloaded data
      downloadButton("download_button", "Download Data")
    )
  )
)

# Define server logic for the Shiny app
server <- function(input, output) {
  # Reactive values for storing the database connection and retrieved data
  con <- reactiveValues()
  data <- reactiveValues()
  
  # Connect to the database when the "Connect to Database" button is clicked
  observeEvent(input$connect_button, {
    # Retrieve user inputs
    user <- input$user_input
    password <- input$password_input
    dbname <- input$dbname_input
    host <- input$host_input
    
    # Create a database connection
    con$connection <- dbConnect(MySQL(), user = user, password = password, dbname = dbname, host = host)
    
    # Check if the connection was successful
    if (!is.null(con$connection)) {
      output$status_output <- renderPrint("Database connection successful.")
    } else {
      output$status_output <- renderPrint("Database connection failed.")
    }
  })
  
  # Retrieve data from the database and store it when the connection is successful
  observeEvent(con$connection, {
    if (!is.null(con$connection)) {
      # Retrieve data from the database
      y2007 <- dbGetQuery(con$connection, "SELECT * FROM yr_2007")
      y2008 <- dbGetQuery(con$connection, "SELECT * FROM yr_2008")
      y2009 <- dbGetQuery(con$connection, "SELECT * FROM yr_2009")
      
      # Combine the data into a single dataframe
      data$df <- bind_rows(y2007, y2008, y2009)
    }
  })
  
  # Download the data as a CSV file
  output$download_button <- downloadHandler(
    filename = "data.csv",
    content = function(file) {
      if (!is.null(data$df)) {
        write.csv(data$df, file, row.names = FALSE)
      }
    }
  )
}

# Run the Shiny app
#shinyApp(ui = ui, server = server)

```

####  3rd option: Load dataset.

```{r}
# Read data.csv
data <- read.csv("data.csv")

# Convert "Date" column to datetime
data$Date <- as.POSIXct(data$Date)

# Select specific years
y2007 <- data[format(data$Date, "%Y") == "2007", ]
y2008 <- data[format(data$Date, "%Y") == "2008", ]
y2009 <- data[format(data$Date, "%Y") == "2009", ]

```


## Investigate each new data frame.


```{r}
## 2007
str(y2007)
summary(y2007)
head(y2007)
tail(y2007)

```

```{r}
## 2008
str(y2008)
summary(y2008)
head(y2008)
tail(y2008)
```

```{r}

## 2009
str(y2009)
summary(y2009)
head(y2009)
tail(y2009)
```
## 1. Preprocessing DATA

## Combine all dataframes
```{r}

df<-(bind_rows(y2007, y2008, y2009))

str(df)
summary(df)
head(df)
tail(df)
```

## Combine date and time columns using as.POSIXct. Change the order of columns
```{r}

df$datetime <- as.POSIXct(paste(df$Date, df$Time), format = "%Y-%m-%d %H:%M:%S")
df <- df[,c(ncol(df), 1:(ncol(df)-1))]
```

```{r}

## Analize by year (Lubridate)
df$year <- year(df$datetime)
```


## This archive contains 2075259 measurements gathered in a house located in 
## Sceaux (7km of Paris, France) between December 2006 and November 2010 (47 months).

## http://archive.ics.uci.edu/ml/datasets/Individual+household+electric+power+consumption

## Checking for Missing Values
```{r}
sum(is.na(df))
```
```{r}
df<-na.omit(df)
```


## Checking for Duplicate Values

```{r}
duplicated_rows <- subset(df, duplicated(df))
print(duplicated_rows)
```


## Types of variables

```{r}
str(df)
summary(df)
```

## Which sub-meter is using the most power? The least? Is there anything to learn from the max and min? 
  
## From the mean of each sub-meter: 
  
## Sub-meter_3 uses the most at 6.458 mean
## Sub_meter_1 uses the least at mean 1.122

## 2. DATA EXPLORATION

## Explore by year, month, day using Lubridate: 


```{r}
df$year <- year(df$datetime)
df$month <-month(df$datetime)
df$week <-week(df$datetime)
df$day<- day(df$datetime)
df$hour<-hour(df$datetime)
df$minute<-minute(df$datetime)
df$weekday <- weekdays(df$datetime)
df$weekday <- factor(df$weekday, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

```


```{r}
df$season <- df %>%
  mutate(season = case_when(
    month %in%  9:11 ~ "Fall",
    month %in%  c(12, 1, 2)  ~ "Winter",
    month %in%  3:5  ~ "Spring",
    TRUE ~ "Summer")) 
```

```{r}
# Now, let's create a sample dataframe with 1000 rows from the larger dataframe
set.seed(123) # set seed for reproducibility
sample_size <- 20000
sample_indices <- sample(1:nrow(df), sample_size, replace = FALSE)
df_sample <- df[sample_indices, ]

head(df_sample)
write.csv(df_sample, file = "df_sample.csv", row.names = FALSE)


```

## Using mean: 

```{r}
by_year <- df %>% group_by(year)

by_year %>% summarise(
  Sub_metering_1 = mean(Sub_metering_1),
  Sub_metering_2 = mean(Sub_metering_2),
  Sub_metering_3 = mean(Sub_metering_3)
)

by_month <- df %>% group_by(month)

by_month %>% summarise(
  Sub_metering_1 = mean(Sub_metering_1),
  Sub_metering_2 = mean(Sub_metering_2),
  Sub_metering_3 = mean(Sub_metering_3)
)


by_week<- df %>% group_by(week)

by_week %>% summarise(
  Sub_metering_1 = mean(Sub_metering_1),
  Sub_metering_2 = mean(Sub_metering_2),
  Sub_metering_3 = mean(Sub_metering_3)
)

by_day<- df %>% group_by(day)

by_day %>% summarise(
  Sub_metering_1 = mean(Sub_metering_1),
  Sub_metering_2 = mean(Sub_metering_2),
  Sub_metering_3 = mean(Sub_metering_3)
)

by_hour<- df %>% group_by(day)

by_hour %>% summarise(
  Sub_metering_1 = mean(Sub_metering_1),
  Sub_metering_2 = mean(Sub_metering_2),
  Sub_metering_3 = mean(Sub_metering_3)
)

by_minute<- df %>% group_by(day)

by_minute %>% summarise(
  Sub_metering_1 = mean(Sub_metering_1),
  Sub_metering_2 = mean(Sub_metering_2),
  Sub_metering_3 = mean(Sub_metering_3)
)
```
#LEGEND: 
#SUB_METER 1-> KITCHEN
#SUB_METER_2-> LAUNDRY ROOM
#SUB_METER_3-> WATER HEATER & AC

#1. SUM ALL 3 SUBMETERS

```{r}
df$total_sub_meter<-df$Sub_metering_1 + df$Sub_metering_2 + df$Sub_metering_3
```

#2.WEEKLY SUB_METER_MEANS

#2.1 WEEKLY/WEEKDAY/MONTHLY/HOURLY MEAN SUB_METER_1 KITCHEN for 2007 & 2008 & 2009

```{r}
mean_per_week_kitchen <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, week) %>%
  summarise(mean = mean(Sub_metering_1), .groups = "drop") %>%
  arrange(year, week)

mean_per_weekday_kitchen <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(Sub_metering_1), .groups = "drop") %>%
  arrange(year, weekday)

mean_per_month_kitchen <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, month, week, day, weekday) %>%
  summarise(mean = mean(Sub_metering_1), .groups = "drop") %>%
  arrange(year, month, week, day, weekday)

mean_per_hour_kitchen <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, hour) %>%
  summarise(mean = mean(Sub_metering_1), .groups = "drop") %>%
  arrange(year, hour)

```

# 2.2. WEEKLY/WEEKDAY/MONTHLY MEAN SUB_METER_2 LAUNDRY ROOM for 2007 & 2008 & 2009

```{r}
mean_per_week_laundry <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, week) %>%
  summarise(mean = mean(Sub_metering_2), .groups = "drop") %>%
  arrange(year)

mean_per_weekday_laundry<- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(Sub_metering_2), .groups = "drop") %>%
  arrange(year, weekday) 

mean_per_month_laundry <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, month, week, day, weekday) %>%
  summarise(mean = mean(Sub_metering_2), .groups = "drop") %>%
  arrange(year, month, week, day, weekday) 

mean_per_hour_laundry <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, hour) %>%
  summarise(mean = mean(Sub_metering_2), .groups = "drop") %>%
  arrange(year, hour) 
```


# 2.3. WEEKLY/WEEKDAY/MONTHLY MEAN SUB_METER_3 ('Water Heater & AC) for 2007, 2008 & 2009, decomposed

```{r}
mean_per_week_water <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, week) %>%
  summarise(mean = mean(Sub_metering_3), .groups = "drop") %>%
  arrange(year, week)

mean_per_weekday_water <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(Sub_metering_3), .groups = "drop") %>%
  arrange(year, weekday) 

mean_per_month_water <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, month, week, day, weekday) %>%
  summarise(mean = mean(Sub_metering_3), .groups = "drop") %>%
  arrange(year, month, week, day, weekday) 

mean_per_water <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, weekday, hour) %>%
  summarise(mean = mean(Sub_metering_3), .groups = "drop") %>%
  arrange(year, weekday, hour) 

mean_per_hour_water <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, hour) %>%
  summarise(mean = mean(Sub_metering_3), .groups = "drop") %>%
  arrange(year, hour) 
```


# 2.4. TOTAL SUB_METER MEAN PER DAY

```{r}
mean_per_week_total <-df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, week) %>%
  summarise(mean = mean(total_sub_meter), .groups = "drop") %>%
  arrange(year, week)

mean_per_weekday_total <- df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(Sub_metering_1+Sub_metering_2+Sub_metering_3), .groups = "drop") %>%
  arrange(year, weekday) 

mean_per_month_total <-df %>%
  filter(year %in% c(2007, 2008, 2009)) %>%
  group_by(year, month, week, day, weekday) %>%
  summarise(mean = mean(total_sub_meter), .groups = "drop") %>%
  arrange(year, month, week, day, weekday)
```

# 2.5. TOTAL SUB_METER MEAN PER YEAR

```{r}
mean_2007 <- df %>%
  filter(year %in% c(2007)) %>%
  group_by(weekday) %>%
  summarise('2007' = mean(total_sub_meter), .groups = "drop") %>%
  arrange(weekday) 

mean_2008 <- df %>%
  filter(year %in% c(2008)) %>%
  group_by(weekday) %>%
  summarise('2008' = mean(total_sub_meter), .groups = "drop") %>%
  arrange(weekday) 

mean_2009 <- df %>%
  filter(year %in% c(2009)) %>%
  group_by(year, weekday) %>%
  summarise('2009' = mean(total_sub_meter), .groups = "drop") %>%
  arrange(year, weekday) 
```

#3. PER SEASON and SUB-METER AND WEEKDAY

#3.1. SUB-METER 1 - KITCHEN

```{r}
season_1 <-df %>%
  group_by(year, month, weekday) %>%
  summarise(mean = mean(Sub_metering_1)) %>%
  arrange(year, month) 

season_1<- season_1 %>%
  mutate(season = case_when(
    month %in%  9:11 ~ "Fall",
    month %in%  c(12, 1, 2)  ~ "Winter",
    month %in%  3:5  ~ "Spring",
    TRUE ~ "Summer")) 

season_1 <- subset(season_1, select = - c(month))   
season_1 

season_1_1 <-season_1 %>%
  filter(season %in% c("Winter")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_1_2 <-season_1 %>%
  filter(season %in% c("Spring")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_1_3 <-season_1 %>%
  filter(season %in% c("Summer")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_1_4 <-season_1 %>%
  filter(season %in% c("Fall")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_kitchen<-season_1_1 %>% 
  left_join(season_1_2, by = c("year","weekday")) %>%
  left_join(season_1_3, by = c("year","weekday")) %>%
  left_join(season_1_4, by = c("year","weekday"))

seasonal_kitchen <- season_kitchen %>%
  rename(mean_per_kitchen_winter = mean.x,
         mean_per_kitchen_spring = mean.y,
         mean_per_kitchen_summer = mean.x.x,
         mean_per_kitchen_fall = mean.y.y)
```
  
#3.1. SUB-METER 2 - LAUNDRY

```{r}
season_2 <-df %>%
  group_by(year, month, weekday) %>%
  summarise(mean = mean(Sub_metering_2)) %>%
  arrange(year, month) 


season_2<- season_2 %>%
  mutate(season = case_when(
    month %in%  9:11 ~ "Fall",
    month %in%  c(12, 1, 2)  ~ "Winter",
    month %in%  3:5  ~ "Spring",
    TRUE ~ "Summer")) 

season_2 <- subset(season_2, select = - c(month))   
season_2 

season_2_1 <-season_2 %>%
  filter(season %in% c("Winter")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_2_2 <-season_2 %>%
  filter(season %in% c("Spring")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_2_3 <-season_2 %>%
  filter(season %in% c("Summer")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_2_4 <-season_2 %>%
  filter(season %in% c("Fall")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_laundry<-season_2_1 %>% 
  left_join(season_2_2, by = c("year","weekday")) %>%
  left_join(season_2_3, by = c("year","weekday")) %>%
  left_join(season_2_4, by = c("year","weekday"))

seasonal_laundry <- season_laundry %>%
  rename(mean_per_laundry_winter = mean.x,
         mean_per_laundry_spring = mean.y,
         mean_per_laundry_summer = mean.x.x,
         mean_per_laundry_fall = mean.y.y)
```

#3.3. SUB-METER 3 - WATER


```{r}
season_3 <-df %>%
  group_by(year, month, weekday) %>%
  summarise(mean = mean(Sub_metering_3)) %>%
  arrange(year, month) 


season_3<- season_3 %>%
  mutate(season = case_when(
    month %in%  9:11 ~ "Fall",
    month %in%  c(12, 1, 2)  ~ "Winter",
    month %in%  3:5  ~ "Spring",
    TRUE ~ "Summer")) 

season_3 <- subset(season_3, select = - c(month))   
season_3 

season_3_1 <-season_3 %>%
  filter(season %in% c("Winter")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_3_2 <-season_3 %>%
  filter(season %in% c("Spring")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_3_3 <-season_3 %>%
  filter(season %in% c("Summer")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_3_4 <-season_3 %>%
  filter(season %in% c("Fall")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean)) %>%
  arrange(year, weekday) 

season_water<-season_3_1 %>% 
  left_join(season_3_2, by = c("year","weekday")) %>%
  left_join(season_3_3, by = c("year","weekday")) %>%
  left_join(season_3_4, by = c("year","weekday"))

seasonal_water <- season_water %>%
  rename(mean_per_water_winter = mean.x,
         mean_per_water_spring = mean.y,
         mean_per_water_summer = mean.x.x,
         mean_per_water_fall = mean.y.y)

```


#3. PER HOUR and SUB-METER AND WEEKDAY

#3.1. SUB-METER 1 - KITCHEN

```{r}
hour_kitchen <-df %>%
  group_by(year, weekday, hour) %>%
  summarise(mean = mean(Sub_metering_1), .groups = "drop") %>%
  arrange(year, weekday, hour) 

hour_kitchen<- hour_kitchen %>%
  mutate(timezone = case_when(
    hour %in%  6:13 ~ "Morning",
    hour %in%  13:15  ~ "MidDay",
    hour %in%  15:19  ~ "Afternoon",
    hour %in%  19:23  ~ "Noon",
    hour %in%  c(23, 0, 1, 2, 3, 4, 5, 6)  ~ "Night")) 

hour_morning_kitchen <-hour_kitchen %>%
  filter(timezone%in% c("Morning")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_midday_kitchen <-hour_kitchen %>%
  filter(timezone %in% c("MidDay")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_afternoon_kitchen <-hour_kitchen %>%
  filter(timezone %in% c("Afternoon")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_noon_kitchen <-hour_kitchen %>%
  filter(timezone %in% c("Noon")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_night_kitchen <-hour_kitchen %>%
  filter(timezone %in% c("Night")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_kitchen<-hour_morning_kitchen %>% 
  left_join(hour_midday_kitchen, by = c("year","weekday")) %>%
  left_join(hour_afternoon_kitchen, by = c("year","weekday")) %>%
  left_join(hour_noon_kitchen, by = c("year","weekday")) %>%
  left_join(hour_night_kitchen, by = c("year","weekday"))
  
hour_kitchen <- hour_kitchen %>%
  rename(morning_kitchen = mean.x,
         midday_kitchen = mean.y,
         afternoon_kitchen = mean.x.x,
         noon_kitchen = mean.y.y,
         night_kitchen = mean)
```


#3.2. SUB-METER 2 - LAUNDRY

```{r}
hour_laundry <-df %>%
  group_by(year, weekday, hour) %>%
  summarise(mean = mean(Sub_metering_2), .groups = "drop") %>%
  arrange(year, weekday, hour) 

hour_laundry<- hour_laundry %>%
  mutate(timezone = case_when(
    hour %in%  6:13 ~ "Morning",
    hour %in%  13:15  ~ "MidDay",
    hour %in%  15:19  ~ "Afternoon",
    hour %in%  19:23  ~ "Noon",
    hour %in%  c(23, 0, 1, 2, 3, 4, 5, 6)  ~ "Night")) 

hour_morning_laundry <-hour_laundry %>%
  filter(timezone%in% c("Morning")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_midday_laundry <-hour_laundry %>%
  filter(timezone %in% c("MidDay")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_afternoon_laundry <-hour_laundry %>%
  filter(timezone %in% c("Afternoon")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_noon_laundry <-hour_laundry %>%
  filter(timezone %in% c("Noon")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_night_laundry <-hour_laundry %>%
  filter(timezone %in% c("Night")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_laundry<-hour_morning_laundry %>% 
  left_join(hour_midday_laundry, by = c("year","weekday")) %>%
  left_join(hour_afternoon_laundry, by = c("year","weekday")) %>%
  left_join(hour_noon_laundry, by = c("year","weekday")) %>%
  left_join(hour_night_laundry, by = c("year","weekday"))

hour_laundry <- hour_laundry %>%
  rename(morning_laundry = mean.x,
         midday_laundry = mean.y,
         afternoon_laundry = mean.x.x,
         noon_laundry = mean.y.y,
         night_laundry = mean)
```


#3.3. SUB-METER 3 - WATER

```{r}
hour_water <-df %>%
  group_by(year, weekday, hour) %>%
  summarise(mean = mean(Sub_metering_3), .groups = "drop") %>%
  arrange(year, weekday, hour) 

hour_water<- hour_water %>%
  mutate(timezone = case_when(
    hour %in%  6:13 ~ "Morning",
    hour %in%  13:15  ~ "MidDay",
    hour %in%  15:19  ~ "Afternoon",
    hour %in%  19:23  ~ "Noon",
    hour %in%  c(23, 0, 1, 2, 3, 4, 5, 6)  ~ "Night")) 

hour_morning_water <-hour_water %>%
  filter(timezone%in% c("Morning")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_midday_water <-hour_water %>%
  filter(timezone %in% c("MidDay")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_afternoon_water <-hour_water %>%
  filter(timezone %in% c("Afternoon")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_noon_water <-hour_water %>%
  filter(timezone %in% c("Noon")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_night_water <-hour_water %>%
  filter(timezone %in% c("Night")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_water<-hour_morning_water %>% 
  left_join(hour_midday_water, by = c("year","weekday")) %>%
  left_join(hour_afternoon_water, by = c("year","weekday")) %>%
  left_join(hour_noon_water, by = c("year","weekday")) %>%
  left_join(hour_night_water, by = c("year","weekday"))

hour_water <- hour_water %>%
  rename(morning_water = mean.x,
         midday_water = mean.y,
         afternoon_water = mean.x.x,
         noon_water = mean.y.y,
         night_water = mean)
```



#3.1. SUB-METER 1 - KITCHEN


```{r}
hour_week_kitchen <-df %>%
  group_by(year, week, hour) %>%
  summarise(mean = mean(Sub_metering_1), .groups = "drop") %>%
  arrange(year, week, hour) 

hour_week_kitchen<- hour_week_kitchen %>%
  mutate(timezone = case_when(
    hour %in%  6:13 ~ "Morning",
    hour %in%  13:15  ~ "MidDay",
    hour %in%  15:19  ~ "Afternoon",
    hour %in%  19:23  ~ "Noon",
    hour %in%  c(23, 0, 1, 2, 3, 4, 5, 6)  ~ "Night")) 

hour_morning_week_kitchen <-hour_week_kitchen %>%
  filter(timezone%in% c("Morning")) %>%
  group_by(year, week) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, week) 

hour_midday_week_kitchen <-hour_week_kitchen %>%
  filter(timezone %in% c("MidDay")) %>%
  group_by(year, week) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, week) 

hour_afternoon_week_kitchen <-hour_week_kitchen %>%
  filter(timezone %in% c("Afternoon")) %>%
  group_by(year, week) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, week) 

hour_noon_week_kitchen <-hour_week_kitchen %>%
  filter(timezone %in% c("Noon")) %>%
  group_by(year, week) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, week) 

hour_night_week_kitchen<-kitchen <-hour_week_kitchen %>%
  filter(timezone %in% c("Night")) %>%
  group_by(year, week) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, week) 

hour_week_kitchen<-hour_morning_week_kitchen %>% 
  left_join(hour_midday_week_kitchen, by = c("year","week")) %>%
  left_join(hour_afternoon_week_kitchen, by = c("year","week")) %>%
  left_join(hour_noon_week_kitchen, by = c("year","week")) %>%
  left_join(hour_night_week_kitchen, by = c("year","week"))

hour_week_kitchen <- hour_week_kitchen %>%
  rename(morning_week_kitchen = mean.x,
         midday_weeK_kitchen = mean.y,
         afternoon_week_kitchen = mean.x.x,
         noon_week_kitchen = mean.y.y,
         night_week_kitchen = mean)
```


#3.2. SUB-METER 2 - LAUNDRY


```{r}
hour_laundry <-df %>%
  group_by(year, weekday, hour) %>%
  summarise(mean = mean(Sub_metering_2), .groups = "drop") %>%
  arrange(year, weekday, hour) 

hour_laundry<- hour_laundry %>%
  mutate(timezone = case_when(
    hour %in%  6:13 ~ "Morning",
    hour %in%  13:15  ~ "MidDay",
    hour %in%  15:19  ~ "Afternoon",
    hour %in%  19:23  ~ "Noon",
    hour %in%  c(23, 0, 1, 2, 3, 4, 5, 6)  ~ "Night")) 

hour_morning_laundry <-hour_laundry %>%
  filter(timezone%in% c("Morning")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_midday_laundry <-hour_laundry %>%
  filter(timezone %in% c("MidDay")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_afternoon_laundry <-hour_laundry %>%
  filter(timezone %in% c("Afternoon")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_noon_laundry <-hour_laundry %>%
  filter(timezone %in% c("Noon")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_night_laundry <-hour_laundry %>%
  filter(timezone %in% c("Night")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_laundry<-hour_morning_laundry %>% 
  left_join(hour_midday_laundry, by = c("year","weekday")) %>%
  left_join(hour_afternoon_laundry, by = c("year","weekday")) %>%
  left_join(hour_noon_laundry, by = c("year","weekday")) %>%
  left_join(hour_night_laundry, by = c("year","weekday"))

hour_laundry <- hour_laundry %>%
  rename(morning_laundry = mean.x,
         midday_laundry = mean.y,
         afternoon_laundry = mean.x.x,
         noon_laundry = mean.y.y,
         night_laundry = mean)
```

#3.3. SUB-METER 3 - WATER


```{r}
hour_water <-df %>%
  group_by(year, weekday, hour) %>%
  summarise(mean = mean(Sub_metering_3), .groups = "drop") %>%
  arrange(year, weekday, hour) 

hour_water<- hour_water %>%
  mutate(timezone = case_when(
    hour %in%  6:13 ~ "Morning",
    hour %in%  13:15  ~ "MidDay",
    hour %in%  15:19  ~ "Afternoon",
    hour %in%  19:23  ~ "Noon",
    hour %in%  c(23, 0, 1, 2, 3, 4, 5, 6)  ~ "Night")) 

hour_morning_water <-hour_water %>%
  filter(timezone%in% c("Morning")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_midday_water <-hour_water %>%
  filter(timezone %in% c("MidDay")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_afternoon_water <-hour_water %>%
  filter(timezone %in% c("Afternoon")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_noon_water <-hour_water %>%
  filter(timezone %in% c("Noon")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_night_water <-hour_water %>%
  filter(timezone %in% c("Night")) %>%
  group_by(year, weekday) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, weekday) 

hour_water<-hour_morning_water %>% 
  left_join(hour_midday_water, by = c("year","weekday")) %>%
  left_join(hour_afternoon_water, by = c("year","weekday")) %>%
  left_join(hour_noon_water, by = c("year","weekday")) %>%
  left_join(hour_night_water, by = c("year","weekday"))

hour_water <- hour_water %>%
  rename(morning_water = mean.x,
         midday_water = mean.y,
         afternoon_water = mean.x.x,
         noon_water = mean.y.y,
         night_water = mean)

```



#4.1. SUB-METER 1 - KITCHEN BY HOUR AND MONTH


```{r}
month_kitchen <-df %>%
  group_by(year, month, hour) %>%
  summarise(mean = mean(Sub_metering_1), .groups = "drop") %>%
  arrange(year, month, hour) 

month_kitchen<- month_kitchen %>%
  mutate(timezone = case_when(
    hour %in%  6:13 ~ "Morning",
    hour %in%  13:19  ~ "Afternoon",
    hour %in%  19:23  ~ "Dusk",
    hour %in%  c(23, 0, 1, 2, 3, 4, 5, 6)  ~ "Night")) 

month_kitchen<- month_kitchen %>%
  mutate(season = case_when(
                month %in%  9:11 ~ "Fall",
                month %in%  c(12, 1, 2)  ~ "Winter",
                month %in%  3:5  ~ "Spring",
                TRUE ~ "Summer")) 

month_morning_kitchen <-month_kitchen %>%
  filter(timezone %in% c("Morning")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_afternoon_kitchen <-month_kitchen %>%
  filter(timezone %in% c("Afternoon")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_noon_kitchen <-month_kitchen %>%
  filter(timezone %in% c("Afternoon")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_dusk_kitchen <-month_kitchen %>%
  filter(timezone %in% c("Dusk")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_night_kitchen <-month_kitchen %>%
  filter(timezone %in% c("Night")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_kitchen<-month_morning_kitchen %>% 
  left_join(month_afternoon_kitchen, by = c("year","month")) %>%
  left_join(month_dusk_kitchen, by = c("year","month")) %>%
  left_join(month_night_kitchen, by = c("year","month")) 

month_kitchen <- month_kitchen %>%
  rename(morning_kitchen = mean.x,
         afternoon_kitchen = mean.y,
         dusk_kitchen = mean.x.x,
         night_kitchen = mean.y.y)
```


#3.4. SUB-METER 2 - LAUNDRY

```{r}
month_laundry <-df %>%
  group_by(year, month, hour) %>%
  summarise(mean = mean(Sub_metering_1), .groups = "drop") %>%
  arrange(year, month, hour) 

month_laundry<- month_laundry %>%
  mutate(timezone = case_when(
    hour %in%  6:13 ~ "Morning",
    hour %in%  13:19  ~ "Afternoon",
    hour %in%  19:23  ~ "Dusk",
    hour %in%  c(23, 0, 1, 2, 3, 4, 5, 6)  ~ "Night")) 

month_laundry<- month_laundry %>%
  mutate(season = case_when(
    month %in%  9:11 ~ "Fall",
    month %in%  c(12, 1, 2)  ~ "Winter",
    month %in%  3:5  ~ "Spring",
    TRUE ~ "Summer")) 

month_morning_laundry <-month_laundry %>%
  filter(timezone %in% c("Morning")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_afternoon_laundry <-month_laundry %>%
  filter(timezone %in% c("Afternoon")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_dusk_laundry <-month_laundry %>%
  filter(timezone %in% c("Dusk")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_night_laundry <-month_laundry %>%
  filter(timezone %in% c("Night")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_laundry<-month_morning_laundry %>% 
  left_join(month_afternoon_laundry, by = c("year","month")) %>%
  left_join(month_dusk_laundry, by = c("year","month")) %>%
  left_join(month_night_laundry, by = c("year","month")) 

month_laundry <- month_laundry %>%
  rename(morning_laundry = mean.x,
         afternoon_laundry = mean.y,
         dusk_laundry = mean.x.x,
         night_laundry = mean.y.y)
```

#3.3. SUB-METER 3 - WATER


```{r}
month_water <-df %>%
  group_by(year, month, hour) %>%
  summarise(mean = mean(Sub_metering_1), .groups = "drop") %>%
  arrange(year, month, hour) 

month_water<- month_water %>%
  mutate(timezone = case_when(
    hour %in%  6:13 ~ "Morning",
    hour %in%  13:19  ~ "Afternoon",
    hour %in%  19:23  ~ "Dusk",
    hour %in%  c(23, 0, 1, 2, 3, 4, 5, 6)  ~ "Night")) 

month_water<- month_water %>%
  mutate(season = case_when(
    month %in%  9:11 ~ "Fall",
    month %in%  c(12, 1, 2)  ~ "Winter",
    month %in%  3:5  ~ "Spring",
    TRUE ~ "Summer")) 

month_morning_water <-month_water %>%
  filter(timezone %in% c("Morning")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_afternoon_water <-month_water %>%
  filter(timezone %in% c("Afternoon")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_dusk_water <-month_water %>%
  filter(timezone %in% c("Dusk")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_night_water <-month_water %>%
  filter(timezone %in% c("Night")) %>%
  group_by(year, month) %>%
  summarise(mean = mean(mean), .groups = "drop") %>%
  arrange(year, month) 

month_water<-month_morning_water %>% 
  left_join(month_afternoon_water, by = c("year","month")) %>%
  left_join(month_dusk_water, by = c("year","month")) %>%
  left_join(month_night_water, by = c("year","month")) 

month_water <- month_water %>%
  rename(morning_water = mean.x,
         afternoon_water = mean.y,
         dusk_water = mean.x.x,
         night_water = mean.y.y)
```


# 4. JOINING DATAFRAME AND CHANGING NAMES


```{r}
total <- mean_per_week_water %>% 
  left_join(mean_per_week_kitchen, by = c("year", "week")) %>%
  left_join(mean_per_week_laundry, by = c("year", "week")) %>%
  left_join(mean_per_week_total, by = c("year", "week"))

total <- total %>%
  rename(mean_per_week_water = mean.x,
         mean_per_week_kitchen = mean.y,
         mean_per_week_laundry = mean.x.x,
         mean_per_week_total = mean.y.y)

total

total_month<-mean_per_month_water %>% 
  left_join(mean_per_month_kitchen, by = c("year", "month")) %>%
  left_join(mean_per_month_laundry, by = c("year", "month")) %>%
  left_join(mean_per_month_total, by = c("year", "month"))

total_month <- total_month %>%
  rename(mean_per_month_water = mean.x,
         mean_per_month_kitchen = mean.y,
         mean_per_month_laundry = mean.x.x,
         mean_per_month_total= mean.y.y)


total_month <- mean_per_month_water %>% 
  left_join(mean_per_month_kitchen, by = c("year", "month", "week", "day", "weekday")) %>%
  left_join(mean_per_month_laundry, by = c("year", "month", "week", "day", "weekday")) %>%
  left_join(mean_per_month_total, by = c("year", "month", "week", "day", "weekday"))


total_month <- total_month %>%
  rename(mean_per_month_water = mean.x,
         mean_per_month_kitchen = mean.y,
         mean_per_month_laundry = mean.x.x,
         mean_per_month_total= mean.y.y)

total_month

total_year<-mean_2007 %>% 
  left_join(mean_2008, by = c("weekday")) %>%
  left_join(mean_2009, by = c("weekday")) 


total_year


total_season<-season_1 %>% 
  left_join(season_2, by = c("year","season", "weekday")) %>%
  left_join(season_3, by = c("year", "season", "weekday"))

total_season <- total_season %>%
  rename(mean_per_season_kitchen = mean.x,
         mean_per_season_laundry = mean.y,
         mean_per_season_water = mean)

total_season

total_hour<-mean_per_hour_kitchen %>% 
  left_join(mean_per_hour_laundry, by = c("year", "hour")) %>%
  left_join(mean_per_hour_water, by = c("year", "hour"))

total_hour <- total_hour %>%
  rename(mean_per_hour_kitchen = mean.x,
         mean_per_hour_laundry = mean.y,
         mean_per_hour_water = mean)

total_hour

total_weekday<-mean_per_weekday_total %>% 
  left_join(mean_per_weekday_kitchen, by = c("year", "weekday")) %>%
  left_join(mean_per_weekday_laundry, by = c("year", "weekday")) %>%
  left_join(mean_per_weekday_water, by = c("year", "weekday"))

total_weekday <- total_weekday %>%
  rename(mean_per_weekday_total = mean.x,
         mean_per_weekday_kitchen = mean.y,
         mean_per_weekday_laundry = mean.x.x,
         mean_per_weekday_water= mean.y.y)

total_weekday
```


# 5.1. WATER HEATER & AC WEEKLY TIMESERIES

```{r}
weekly_water <- ts(mean_per_week_water$mean, frequency=52.25, start=c(2007,1))
weekly_water<-(weekly_water)
autoplot(weekly_water) + xlab("Week") + ylab("Mean") +
  ggtitle("Water Heater & AC")

boxplot(mean_per_week_water ~ week, 
        data=total, 
        main="Water & AC",
        ylab="Mean", xlab="week")

class(total)
```
# 5.1.1. WATER HEATER & AC WEEKLDAY TIMESERIES

```{r}
weekday_water<-ts(mean_per_weekday_kitchen$mean, frequency=52.25, start=c(2007, 1))
plot(weekday_water)

autoplot(weekday_water) + xlab("Day of the Week") + ylab("Mean") +
  ggtitle("Water Heater & AC")
```


# 5.2. KITCHEN WEEKLY TIMESERIES

```{r}
weekly_kitchen <- ts(mean_per_week_kitchen$mean, frequency=52.25, start=c(2007,1))

plot(weekly_kitchen)
autoplot(weekly_kitchen) + xlab("Week") + ylab("Mean") +
  ggtitle("Kitchen")
```

# 5.3. LAUNDRY ROOM TIMESERIES

```{r}
weekly_laundry<- ts(mean_per_week_laundry$mean, frequency=52.25, start=c(2007,1))

plot(weekly_laundry)
autoplot(weekly_laundry) + xlab("Week") + ylab("Mean") +
  ggtitle("Laundry Room")
```

# 5.4. TOTAL WEEKLY TIMESERIES

```{r}
weekly_total<- ts(mean_per_week_total$mean, frequency=52.25, start=c(2007,1))
plot(weekly_total)
```

# 5.5. TOTAL POWER CONSUMPTION BY YEAR

```{r}
by_year<-plot_ly(total_year, x = ~total_year$weekday, y = ~total_year$"2007", 
        name = '2007', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~total_year$"2008" , name = '2008', mode = 'lines') %>%
  add_trace(y = ~total_year$"2009", name = '2009', mode = 'lines') %>%
  layout(title = "Total Power Consumption by Year",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))

by_year
```


# 5.6. 2007 CONSUMPTION BY SUBMETER weekday

```{r}
weekdayy_2007 <- filter(total_weekday, (year == 2007))
weekday_2007<-plot_ly(weekdayy_2007, x = ~weekdayy_2007$weekday, y = ~weekdayy_2007$"mean_per_weekday_water", 
         name = 'mean_per_weekday_water ', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~weekdayy_2007$"mean_per_weekday_kitchen" , name = 'mean_per_weekday_kitchen ', mode = 'lines') %>%
  add_trace(y = ~weekdayy_2007$"mean_per_weekday_laundry", name = 'mean_per_weekday_laundry ', mode = 'lines') %>%
  layout(title = "Power Consumption by Sub-meter 2007",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))
weekday_2007
```

# 5.6. 2008 CONSUMPTION BY SUBMETER weekday

```{r}
weekdayy_2008 <- filter(total_weekday, (year == 2008))
weekday_2008<-plot_ly(weekdayy_2008, x = ~weekdayy_2008$weekday, y = ~weekdayy_2008$"mean_per_weekday_water", 
                      name = 'mean_per_weekday_water ', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~weekdayy_2008$"mean_per_weekday_kitchen" , name = 'mean_per_weekday_kitchen ', mode = 'lines') %>%
  add_trace(y = ~weekdayy_2008$"mean_per_weekday_laundry", name = 'mean_per_weekday_laundry ', mode = 'lines') %>%
  layout(title = "Power Consumption by Sub-meter 2008",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))
weekday_2008
```


# 5.6. 2009 CONSUMPTION BY SUBMETER weekday

```{r}
weekdayy_2009 <- filter(total_weekday, (year == 2009))
weekday_2009<-plot_ly(weekdayy_2009, x = ~weekdayy_2009$weekday, y = ~weekdayy_2009$"mean_per_weekday_water", 
                      name = 'mean_per_weekday_water ', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~weekdayy_2009$"mean_per_weekday_kitchen" , name = 'mean_per_weekday_kitchen ', mode = 'lines') %>%
  add_trace(y = ~weekdayy_2009$"mean_per_weekday_laundry", name = 'mean_per_weekday_laundry ', mode = 'lines') %>%
  layout(title = "Power Consumption by Sub-meter 2009",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))
weekday_2009
```


# 5.6. PLOT BY SEASON (HUE), SUB_METER1, YEAR

```{r}
kitchen_season <- filter(seasonal_kitchen, (year == 2007))
kitchen_season_2007<-plot_ly(kitchen_season, x = ~kitchen_season$weekday, y = ~kitchen_season$"mean_per_kitchen_winter", 
                             name = 'WINTER', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~kitchen_season$"mean_per_kitchen_spring" , name = 'SPRING', mode = 'lines') %>%
  add_trace(y = ~kitchen_season$"mean_per_kitchen_summer", name = 'SUMMER', mode = 'lines') %>%
  add_trace(y = ~kitchen_season$"mean_per_kitchen_fall", name = 'FALL', mode = 'lines') %>%
  layout(title = "Power Consumption kitchen 2007",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))

kitchen_seasonn <- filter(seasonal_kitchen, (year == 2008))
kitchen_season_2008<-plot_ly(kitchen_seasonn, x = ~kitchen_seasonn$weekday, y = ~kitchen_seasonn$"mean_per_kitchen_winter", 
                             name = 'WINTER', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~kitchen_seasonn$"mean_per_kitchen_spring" , name = 'SPRING', mode = 'lines') %>%
  add_trace(y = ~kitchen_seasonn$"mean_per_kitchen_summer", name = 'SUMMER', mode = 'lines') %>%
  add_trace(y = ~kitchen_seasonn$"mean_per_kitchen_fall", name = 'FALL', mode = 'lines') %>%
  layout(title = "Power Consumption kitchen 2008",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))

kitchen_seasonnn <- filter(seasonal_kitchen, (year == 2009))
kitchen_season_2009<-plot_ly(kitchen_seasonnn, x = ~kitchen_seasonnn$weekday, y = ~kitchen_seasonnn$"mean_per_kitchen_winter", 
                             name = 'WINTER', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~kitchen_seasonnn$"mean_per_kitchen_spring" , name = 'SPRING', mode = 'lines') %>%
  add_trace(y = ~kitchen_seasonnn$"mean_per_kitchen_summer", name = 'SUMMER', mode = 'lines') %>%
  add_trace(y = ~kitchen_seasonnn$"mean_per_kitchen_fall", name = 'FALL', mode = 'lines') %>%
  layout(title = "Power Consumption kitchen 2009",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))
kitchen_season_2007
```


# 5.6. PLOT BY SEASON (HUE), SUB_METER2, YEAR

```{r}
laundry_season <- filter(seasonal_laundry, (year == 2007))
laundry_season_2007<-plot_ly(laundry_season, x = ~laundry_season$weekday, y = ~laundry_season$"mean_per_laundry_winter", 
                             name = 'WINTER', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~laundry_season$"mean_per_laundry_spring" , name = 'SPRING', mode = 'lines') %>%
  add_trace(y = ~laundry_season$"mean_per_laundry_summer", name = 'SUMMER', mode = 'lines') %>%
  add_trace(y = ~laundry_season$"mean_per_laundry_fall", name = 'FALL', mode = 'lines') %>%
  layout(title = "Power Consumption LAUNDRY 2007",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))

laundry_seasonn <- filter(seasonal_laundry, (year == 2008))
laundry_season_2008<-plot_ly(laundry_seasonn, x = ~laundry_seasonn$weekday, y = ~laundry_seasonn$"mean_per_laundry_winter", 
                             name = 'WINTER', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~laundry_seasonn$"mean_per_laundry_spring" , name = 'SPRING', mode = 'lines') %>%
  add_trace(y = ~laundry_seasonn$"mean_per_laundry_summer", name = 'SUMMER', mode = 'lines') %>%
  add_trace(y = ~laundry_seasonn$"mean_per_laundry_fall", name = 'FALL', mode = 'lines') %>%
  layout(title = "Power Consumption LAUNDRY 2008",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))

laundry_seasonnn <- filter(seasonal_laundry, (year == 2009))
laundry_season_2009<-plot_ly(laundry_seasonnn, x = ~laundry_seasonnn$weekday, y = ~laundry_seasonnn$"mean_per_laundry_winter", 
                             name = 'WINTER', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~laundry_seasonnn$"mean_per_laundry_spring" , name = 'SPRING', mode = 'lines') %>%
  add_trace(y = ~laundry_seasonnn$"mean_per_laundry_summer", name = 'SUMMER', mode = 'lines') %>%
  add_trace(y = ~laundry_seasonnn$"mean_per_laundry_fall", name = 'FALL', mode = 'lines') %>%
  layout(title = "Power Consumption LAUNDRY 2009",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))
laundry_season_2007
```


# 5.7. PLOT BY SEASON (HUE), SUB_METER3, YEAR

```{r}
water_season <- filter(seasonal_water, (year == 2007))
water_season_2007<-plot_ly(water_season, x = ~water_season$weekday, y = ~water_season$"mean_per_water_winter", 
                             name = 'WINTER', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~water_season$"mean_per_water_spring" , name = 'SPRING', mode = 'lines') %>%
  add_trace(y = ~water_season$"mean_per_water_summer", name = 'SUMMER', mode = 'lines') %>%
  add_trace(y = ~water_season$"mean_per_water_fall", name = 'FALL', mode = 'lines') %>%
  layout(title = "Power Consumption WATER 2007",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))

water_seasonn <- filter(seasonal_water, (year == 2008))
water_season_2008<-plot_ly(water_seasonn, x = ~water_seasonn$weekday, y = ~water_seasonn$"mean_per_water_winter", 
                             name = 'WINTER', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~water_seasonn$"mean_per_water_spring" , name = 'SPRING', mode = 'lines') %>%
  add_trace(y = ~water_seasonn$"mean_per_water_summer", name = 'SUMMER', mode = 'lines') %>%
  add_trace(y = ~water_seasonn$"mean_per_water_fall", name = 'FALL', mode = 'lines') %>%
  layout(title = "Power Consumption WATER 2008",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))

water_seasonnn <- filter(seasonal_water, (year == 2009))
water_season_2009<-plot_ly(water_seasonnn, x = ~water_seasonnn$weekday, y = ~water_seasonnn$"mean_per_water_winter", 
                             name = 'WINTER', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~water_seasonnn$"mean_per_water_spring" , name = 'SPRING', mode = 'lines') %>%
  add_trace(y = ~water_seasonnn$"mean_per_water_summer", name = 'SUMMER', mode = 'lines') %>%
  add_trace(y = ~water_seasonnn$"mean_per_water_fall", name = 'FALL', mode = 'lines') %>%
  layout(title = "Power Consumption WATER 2009",
         xaxis = list(title = "Weekday"),
         yaxis = list (title = "Power (watt-hours)"))
water_season_2007
```

#6. PLOT BY HOUR

```{r}
hour_207 <- filter(total_hour, (year == 2007))
hour_2007<-plot_ly(hour_207, x = ~hour_207$hour, y = ~hour_207$"mean_per_hour_kitchen", 
                           name = 'KITCHEN', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hour_207$"mean_per_hour_laundry" , name = 'LAUNDRY', mode = 'lines') %>%
  add_trace(y = ~hour_207$"mean_per_hour_water", name = 'WATER', mode = 'lines') %>%
  layout(title = "Power Consumption WATER by hour 2007",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))

hour_208 <- filter(total_hour, (year == 2008))
hour_2008<-plot_ly(hour_208, x = ~hour_208$hour, y = ~hour_208$"mean_per_hour_kitchen", 
                   name = 'KITCHEN', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hour_208$"mean_per_hour_laundry" , name = 'LAUNDRY', mode = 'lines') %>%
  add_trace(y = ~hour_208$"mean_per_hour_water", name = 'WATER', mode = 'lines') %>%
  layout(title = "Power Consumption by hour 2008",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))

hour_209 <- filter(total_hour, (year == 2009))
hour_2009<-plot_ly(hour_209, x = ~hour_209$hour, y = ~hour_209$"mean_per_hour_kitchen", 
                   name = 'KITCHEN', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hour_209$"mean_per_hour_laundry" , name = 'LAUNDRY', mode = 'lines') %>%
  add_trace(y = ~hour_209$"mean_per_hour_water", name = 'WATER', mode = 'lines') %>%
  layout(title = "Power Consumption by hour 2009",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))
hour_2007
hour_2008
hour_2009
```

# 5.6. PLOT BY HOUR (HUE), SUB_METER1, YEAR

```{r}
hourly_kitchen <- filter(hour_kitchen, (year == 2007))
ly_2007<-plot_ly(hourly_kitchen, x = ~hourly_kitchen$weekday, y = ~hourly_kitchen$"morning_kitchen", 
                   name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hourly_kitchen$"midday_kitchen" , name = 'MidDay', mode = 'lines') %>%
  add_trace(y = ~hourly_kitchen$"afternoon_kitchen", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~hourly_kitchen$"noon_kitchen", name = 'Noon', mode = 'lines') %>%
  add_trace(y = ~hourly_kitchen$"night_kitchen", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Kitchen 2007",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))

hourlyy_kitchen <- filter(hour_kitchen, (year == 2008))
ly_2008<-plot_ly(hourlyy_kitchen, x = ~hourlyy_kitchen$weekday, y = ~hourlyy_kitchen$"morning_kitchen", 
                 name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hourlyy_kitchen$"midday_kitchen" , name = 'MidDay', mode = 'lines') %>%
  add_trace(y = ~hourlyy_kitchen$"afternoon_kitchen", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~hourlyy_kitchen$"noon_kitchen", name = 'Noon', mode = 'lines') %>%
  add_trace(y = ~hourlyy_kitchen$"night_kitchen", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Kitchen 2008",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))

hourlyyy_kitchen <- filter(hour_kitchen, (year == 2009))
ly_2009<-plot_ly(hourlyyy_kitchen, x = ~hourlyyy_kitchen$weekday, y = ~hourlyyy_kitchen$"morning_kitchen", 
                 name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_kitchen$"midday_kitchen" , name = 'MidDay', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_kitchen$"afternoon_kitchen", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_kitchen$"noon_kitchen", name = 'Noon', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_kitchen$"night_kitchen", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Kitchen 2009",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))
ly_2007
ly_2008
ly_2009


```

# 5.7. PLOT BY HOUR (HUE), SUB_METER2, YEAR

```{r}
hourly_laundry <- filter(hour_laundry, (year == 2007))
lyy_2007<-plot_ly(hourly_laundry, x = ~hourly_laundry$weekday, y = ~hourly_laundry$"morning_laundry", 
                 name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hourly_laundry$"midday_laundry" , name = 'MidDay', mode = 'lines') %>%
  add_trace(y = ~hourly_laundry$"afternoon_laundry", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~hourly_laundry$"noon_laundry", name = 'Noon', mode = 'lines') %>%
  add_trace(y = ~hourly_laundry$"night_laundry", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Laundry Room 2007",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))

hourlyy_laundry <- filter(hour_laundry, (year == 2008))
lyy_2008<-plot_ly(hourlyy_laundry, x = ~hourlyy_laundry$weekday, y = ~hourlyy_laundry$"morning_laundry", 
                 name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hourlyy_laundry$"midday_laundry" , name = 'MidDay', mode = 'lines') %>%
  add_trace(y = ~hourlyy_laundry$"afternoon_laundry", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~hourlyy_laundry$"noon_laundry", name = 'Noon', mode = 'lines') %>%
  add_trace(y = ~hourlyy_laundry$"night_laundry", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Laundry Room 2008",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))

hourlyyy_laundry <- filter(hour_laundry, (year == 2009))
lyy_2009<-plot_ly(hourlyyy_laundry, x = ~hourlyyy_laundry$weekday, y = ~hourlyyy_laundry$"morning_laundry", 
                 name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_laundry$"midday_laundry" , name = 'MidDay', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_laundry$"afternoon_laundry", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_laundry$"noon_laundry", name = 'Noon', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_laundry$"night_laundry", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Laundry Room 2009",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))

lyy_2007
lyy_2008
lyy_2009
```

# 5.7. PLOT BY HOUR (HUE), SUB_METER3, YEAR

```{r}
hourly_water <- filter(hour_water, (year == 2007))
lyyy_2007<-plot_ly(hourly_water, x = ~hourly_water$weekday, y = ~hourly_water$"morning_water", 
                  name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hourly_water$"midday_water" , name = 'MidDay', mode = 'lines') %>%
  add_trace(y = ~hourly_water$"afternoon_water", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~hourly_water$"noon_water", name = 'Noon', mode = 'lines') %>%
  add_trace(y = ~hourly_water$"night_water", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Water Heater & AC 2007",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))

hourlyy_water <- filter(hour_water, (year == 2008))
lyyy_2008<-plot_ly(hourlyy_water, x = ~hourlyy_water$weekday, y = ~hourlyy_water$"morning_water", 
                  name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hourlyy_water$"midday_water" , name = 'MidDay', mode = 'lines') %>%
  add_trace(y = ~hourlyy_water$"afternoon_water", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~hourlyy_water$"noon_water", name = 'Noon', mode = 'lines') %>%
  add_trace(y = ~hourlyy_water$"night_water", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Water Heater & AC 2008",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))

hourlyyy_water <- filter(hour_water, (year == 2009))
lyyy_2009<-plot_ly(hourlyyy_water, x = ~hourlyyy_water$weekday, y = ~hourlyyy_water$"morning_water", 
                  name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_water$"midday_water" , name = 'MidDay', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_water$"afternoon_water", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_water$"noon_water", name = 'Noon', mode = 'lines') %>%
  add_trace(y = ~hourlyyy_water$"night_water", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Water Heater & AC 2009",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))

lyyy_2007
lyyy_2008
lyyy_2009
```

# 5.8. PLOT BY HOUR (HUE), SUB_METER1, MONTH 

```{r}
monthly_kitchen <- filter(month_kitchen, (year == 2007))
thly_2007<-plot_ly(monthly_kitchen , x = ~monthly_kitchen$month, y = ~monthly_kitchen$"morning_kitchen", 
                 name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~monthly_kitchen$"afternoon_kitchen", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~monthly_kitchen$"dusk_kitchen", name = 'Dusk', mode = 'lines') %>%
  add_trace(y = ~monthly_kitchen$"night_kitchen", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Kitchen 2007",
         xaxis = list(title = "Month"),
         yaxis = list (title = "Power (watt-hours)"))

monthly_kitchen <- filter(month_kitchen, (year == 2008))
thly_2008<-plot_ly(monthly_kitchen , x = ~monthly_kitchen$month, y = ~monthly_kitchen$"morning_kitchen", 
                   name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~monthly_kitchen$"afternoon_kitchen", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~monthly_kitchen$"dusk_kitchen", name = 'Dusk', mode = 'lines') %>%
  add_trace(y = ~monthly_kitchen$"night_kitchen", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Kitchen 2008",
         xaxis = list(title = "Month"),
         yaxis = list (title = "Power (watt-hours)"))

monthly_kitchen <- filter(month_kitchen, (year == 2009))
thly_2009<-plot_ly(monthly_kitchen , x = ~monthly_kitchen$month, y = ~monthly_kitchen$"morning_kitchen", 
                   name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~monthly_kitchen$"afternoon_kitchen", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~monthly_kitchen$"dusk_kitchen", name = 'Dusk', mode = 'lines') %>%
  add_trace(y = ~monthly_kitchen$"night_kitchen", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Kitchen 2009",
         xaxis = list(title = "Month"),
         yaxis = list (title = "Power (watt-hours)"))
thly_2007
thly_2008
thly_2009
```

# 5.8. PLOT BY HOUR (HUE), SUB_METER2, MONTH 

```{r}
monthly_laundry <- filter(month_laundry, (year == 2007))
thlyy_2007<-plot_ly(monthly_laundry , x = ~monthly_laundry$month, y = ~monthly_laundry$"morning_laundry", 
                   name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~monthly_laundry$"afternoon_laundry", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~monthly_laundry$"dusk_laundry", name = 'Dusk', mode = 'lines') %>%
  add_trace(y = ~monthly_laundry$"night_laundry", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour laundry 2007",
         xaxis = list(title = "Month"),
         yaxis = list (title = "Power (watt-hours)"))

monthly_laundry <- filter(month_laundry, (year == 2008))
thlyy_2008<-plot_ly(monthly_laundry , x = ~monthly_laundry$month, y = ~monthly_laundry$"morning_laundry", 
                    name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~monthly_laundry$"afternoon_laundry", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~monthly_laundry$"dusk_laundry", name = 'Dusk', mode = 'lines') %>%
  add_trace(y = ~monthly_laundry$"night_laundry", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour laundry 2008",
         xaxis = list(title = "Month"),
         yaxis = list (title = "Power (watt-hours)"))

monthly_laundry <- filter(month_laundry, (year == 2009))
thlyy_2009<-plot_ly(monthly_laundry , x = ~monthly_laundry$month, y = ~monthly_laundry$"morning_laundry", 
                    name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~monthly_laundry$"afternoon_laundry", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~monthly_laundry$"dusk_laundry", name = 'Dusk', mode = 'lines') %>%
  add_trace(y = ~monthly_laundry$"night_laundry", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour laundry 2009",
         xaxis = list(title = "Month"),
         yaxis = list (title = "Power (watt-hours)"))
thlyy_2007
thlyy_2008
thlyy_2009
```

# 5.8. PLOT BY HOUR (HUE), SUB_METER3, MONTH 

```{r}
monthly_water <- filter(month_water, (year == 2007))
thlyyy_2007<-plot_ly(monthly_water , x = ~monthly_water$month, y = ~monthly_water$"morning_water", 
                    name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~monthly_water$"afternoon_water", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~monthly_water$"dusk_water", name = 'Dusk', mode = 'lines') %>%
  add_trace(y = ~monthly_water$"night_water", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour water 2007",
         xaxis = list(title = "Month"),
         yaxis = list (title = "Power (watt-hours)"))

monthly_water <- filter(month_water, (year == 2008))
thlyyy_2008<-plot_ly(monthly_water , x = ~monthly_water$month, y = ~monthly_water$"morning_water", 
                    name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~monthly_water$"afternoon_water", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~monthly_water$"dusk_water", name = 'Dusk', mode = 'lines') %>%
  add_trace(y = ~monthly_water$"night_water", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour water 2008",
         xaxis = list(title = "Month"),
         yaxis = list (title = "Power (watt-hours)"))

monthly_water <- filter(month_water, (year == 2009))
thlyyy_2009<-plot_ly(monthly_water , x = ~monthly_water$month, y = ~monthly_water$"morning_water", 
                    name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~monthly_water$"afternoon_water", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~monthly_water$"dusk_water", name = 'Dusk', mode = 'lines') %>%
  add_trace(y = ~monthly_water$"night_water", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour water 2009",
         xaxis = list(title = "Month"),
         yaxis = list (title = "Power (watt-hours)"))
thlyyy_2007
thlyyy_2008
thlyyy_2009
```



# 5.7. HOUR BY WEEK

```{r}
hourly_week_kitchen <- filter(hour_week_kitchen, (year == 2007))
ly_week_2007<-plot_ly(hourly_week_kitchen, x = ~hourly_week_kitchen$week, y = ~hourly_week_kitchen$"morning_week_kitchen", 
                 name = 'Morning', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~hourly_week_kitchen$"midday_weeK_kitchen" , name = 'MidDay', mode = 'lines') %>%
  add_trace(y = ~hourly_week_kitchen$"afternoon_week_kitchen", name = 'Afternoon', mode = 'lines') %>%
  add_trace(y = ~hourly_week_kitchen$"noon_week_kitchen", name = 'Noon', mode = 'lines') %>%
  add_trace(y = ~hourly_week_kitchen$"night_week_kitchen", name = 'Night', mode = 'lines') %>%
  layout(title = "Power Consumption by hour Kitchen 2007",
         xaxis = list(title = "hour"),
         yaxis = list (title = "Power (watt-hours)"))
ly_week_2007

```


# 5.5. PLOTLY (PLOTS OF THREE SUB-METERS AND TOTAL TOGETHER)

# Plot all of three sub-meters year 2007

## 2007 - PER WEEK

```{r}
all_2007 <- filter(total, (year == 2007))
## Plot sub-meter 1, 2 and 3 with title, legend and labels 
year_2007<-plot_ly(all_2007, x = ~all_2007$week, y = ~all_2007$mean_per_week_water, name = 'Water Heater & AC', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~all_2007$mean_per_week_kitchen , name = 'Kitchen', mode = 'lines') %>%
  add_trace(y = ~all_2007$mean_per_week_laundry, name = 'Laundry RoomC', mode = 'lines') %>%
  layout(title = "Power Consumption 2007",
         xaxis = list(title = "Week"),
         yaxis = list (title = "Power (watt-hours)"))
year_2007
```

## 2008 - PER WEEK

```{r}
all_2008 <- filter(total, (year == 2008))
## Plot sub-meter 1, 2 and 3 with title, legend and labels 
year_2008<-plot_ly(all_2008, x = ~all_2008$week, y = ~all_2008$mean_per_week_water, name = 'Water Heater & AC', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~all_2008$mean_per_week_kitchen , name = 'Kitchen', mode = 'lines') %>%
  add_trace(y = ~all_2008$mean_per_week_laundry, name = 'Laundry Room', mode = 'lines') %>%
  layout(title = "Power Consumption 2008",
         xaxis = list(title = "Week"),
         yaxis = list (title = "Power (watt-hours)"))
year_2008
```

## 2009 - PER WEEK

```{r}
all_2009 <- filter(total, (year == 2009))
## Plot sub-meter 1, 2 and 3 with title, legend and labels 
year_2009<-plot_ly(all_2009, x = ~all_2009$week, y = ~all_2009$mean_per_week_water, name = 'Water Heater & AC', type = 'scatter', mode = 'lines') %>%
  add_trace(y = ~all_2009$mean_per_week_kitchen , name = 'Kitchen', mode = 'lines') %>%
  add_trace(y = ~all_2009$mean_per_week_laundry, name = 'Laundry Room', mode = 'lines') %>%
  layout(title = "Power Consumption 2009",
         xaxis = list(title = "Week"),
         yaxis = list (title = "Power (watt-hours)"))
year_2009
```


# 5.6. DECOMPOSITION OF TIMESERIES

```{r}
decomp_water <- decompose(weekly_water)
plot(decomp_water)

decomp_kitchen<- decompose(weekly_kitchen)
plot(decomp_kitchen)

decomp_laundry<- decompose(weekly_laundry)
plot(decomp_laundry)

decomp_total<- decompose(weekly_total)
plot(decomp_total)
```

```{r}
weekly <- total[, c("mean_per_week_total", "mean_per_week_water",
                    "mean_per_week_kitchen", "mean_per_week_laundry")]
datacheck<- total[, c("mean_per_week_total")]
```

#DATA / TREND / SEASONAL/REMAINDER


## Note: Multiplicative: Top Line (data)

## TIME SERIES MULTIPLICATIVE AND ADDITIVE CHECK INFORMATION

## Additive Time Series: Top Line (data), variation stays more or less the same, 
## Constant trend


#TAKING AWAY THE TREND FOR TOTAL SUB_METER:

```{r}
weekly_total <- total[, c("mean_per_week_total")]
weekly_total_frequency<-ts(weekly_total, start=c(2007, 1), frequency=52)
DY<-diff(weekly_total_frequency)
autoplot(DY)

ggseasonplot(DY)
ggsubseriesplot(DY)

fit<-snaive(DY)
print(summary(fit))
checkresiduals(fit)
```

## residuals: normal and centered around 0
## ACF: CHECK


```{r}
viewer <- function() {
  
  a <- readline(prompt = "Select from the following: Year / Seasonality / Week / Hour / Month")
  
  if (a == "Year") {    
    b <- readline(prompt = "By which year? (2007 / 2008 / 2009) ")
    if (b == "2007") {
      print(year_2007)
    } else if (b == "2008") {
      print(year_2008)
    } else if (b == "2009") {
      print(year_2009)
    }
  }
  
  if (a == "Seasonality") { 
    c <- readline(prompt = "By which sub-meter? (1 - Kitchen, 2 - Laundry or 3 - Water & AC) ")
    d <- readline(prompt = "By which year? (2007, 2008 or 2009) ")
    if (c == "1" && d == "2007") {
      print(kitchen_season_2007)
    } else if (c == "2" && d == "2007") {
      print(laundry_season_2007)
    } else if (c == "3" && d == "2007") {
      print(water_season_2007)
    } else if (c == "1" && d == "2008") {
      print(kitchen_season_2008)
    } else if (c == "2" && d == "2008") {
      print(laundry_season_2008)
    } else if (c == "3" && d == "2008") {
      print(water_season_2008)
    } else if (c == "1" && d == "2009") {
      print(kitchen_season_2009)
    } else if (c == "2" && d == "2009") {
      print(laundry_season_2009)
    } else if (c == "3" && d == "2009") {
      print(water_season_2009)
    }
  }
  
  if (a == "Week") {
    d <- readline(prompt="By what year? (2007 / 2008 / 2009) ")
    if (d == "2007") {
      print(weekday_2007)
    } else if (d == "2008") {
      print(weekday_2008)
    } else if (d == "2009") {
      print(weekday_2009)
    }
  }
  
  if(a == "Hour") { 
    e <- readline(prompt="By what year? (2007 / 2008 / 2009) ")
    f <- readline(prompt="By which Sub-meter? (1-Kitchen, 2-Laundry or 3-Water) ")
    if (e == "2007") {
      print(hour_2007)
    } else if (e == "2008") {
      print(hour_2008)
    } else if (e == "2009") {
      print(hour_2009)
    }  
    if (e == "2007") {
      if (f=="1-Kitchen") {
        print(ly_2007)
      } else if (f=="2-Laundry") {
        print(lyy_2007)
      } else if (f=="3-Water") {
        print(lyyy_2007)
      }
    } else if (e == "2008") {
      if (f=="1-Kitchen") {
        print(ly_2008)
      } else if (f=="2-Laundry") {
        print(lyy_2008)
      } else if (f=="3-Water") {
        print(lyyy_2008)
      }
    } else if (e == "2009")
      if (f=="1-Kitchen") {
        print(ly_2009)
      } else if (f=="2-Laundry") {
        print(lyy_2009)
      } else if (f=="3-Water") {
        print(lyyy_2009)
      }
  }
  
  if (a == "Month") { 
    g <- readline(prompt = "By which sub-meter? (1 - Kitchen, 2 - Laundry or 3 - Water & AC) ")
    h <- readline(prompt = "By which year? (2007, 2008 or 2009) ")
    if (g == "1 - Kitchen" && h == "2007") {
      print(thly_2007)
    } else if (g == "2 - Laundry" && h == "2007") {
      print(thlyy_2007)
    } else if (g == "3 - Water & AC" && h == "2007") {
      print(thlyyy_2007)
    } else if (g == "1 - Kitchen" && h == "2008") {
      print(thly_2008)
    } else if (g == "2 - Laundry" && h == "2008") {
      print(thlyy_2008)
    } else if (g == "3 - Water & AC" && h == "2008") {
      print(thlyyy_2008)
    } else if (g == "1 - Kitchen" && h == "2009") {
      print(thly_2009)
    } else if (g == "2 - Laundry" && h == "2009") {
      print(thlyy_2009)
    } else if (g == "3 - Water & AC" && h == "2009") {
      print(thlyyy_2009)
    }
  }
}
```

viewer()

Conclusion: Created a function to segment between Year / Seasonality / Week / Hour and Month, 
where the user can visualize how each of the sub-meters behaves by a specific time frame of the years 2007, 2008 an 2009.

#LEGEND: 
#SUB_METER 1-> KITCHEN
#SUB_METER_2-> LAUNDRY ROOM
#SUB_METER_3-> WATER HEATER & AC



